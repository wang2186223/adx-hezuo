<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdX Direct å¹¿å‘Šæµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .ad-container {
            margin: 20px 0;
            padding: 10px;
            border: 2px dashed #ccc;
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .ad-info {
            margin: 10px 0;
            padding: 10px;
            background: #f9f9f9;
            border-left: 4px solid #4CAF50;
            font-family: monospace;
            font-size: 12px;
        }
        .log-area {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
        .status-success { color: #4CAF50; }
        .status-failed { color: #f44336; }
        .status-pending { color: #FF9800; }
    </style>
</head>
<body>
    <h1>ğŸ§ª AdX Direct å¹¿å‘ŠåŠ è½½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>æµ‹è¯•ä¿¡æ¯</h2>
        <div class="ad-info">
            <div><strong>å®¢æˆ·ç«¯ID:</strong> ca-pub-5058896253332104</div>
            <div><strong>å¹¿å‘Šè„šæœ¬:</strong> adsbygoogle_direct.js</div>
            <div><strong>æµ‹è¯•æ—¶é—´:</strong> <span id="test-time"></span></div>
        </div>
        <button onclick="checkAllAds()">ğŸ” æ£€æŸ¥æ‰€æœ‰å¹¿å‘ŠçŠ¶æ€</button>
        <button onclick="clearLogs()">ğŸ—‘ï¸ æ¸…é™¤æ—¥å¿—</button>
        <button onclick="location.reload()">ğŸ”„ åˆ·æ–°é¡µé¢</button>
    </div>

    <div class="test-section">
        <h2>å¹¿å‘Šå•å…ƒæµ‹è¯•</h2>
        
        <!-- Ad Unit 1 -->
        <h3>Banner 1 (adx-23335185836-banner1)</h3>
        <div class="ad-container" id="ad-wrapper-1">
            <ins class="adsbygoogle"
                 style="display:inline-block;width:336px;height:280px"
                 data-ad-client="ca-pub-5058896253332104"
                 data-ad-slot="adx-23335185836-banner1"
                 data-tag-src="gamtg"
                 data-test-id="1"></ins>
        </div>
        <div class="ad-info" id="info-1">ç­‰å¾…æ£€æµ‹...</div>

        <!-- Ad Unit 2 -->
        <h3>Banner 2 (adx-23335185836-banner2)</h3>
        <div class="ad-container" id="ad-wrapper-2">
            <ins class="adsbygoogle"
                 style="display:inline-block;width:336px;height:280px"
                 data-ad-client="ca-pub-5058896253332104"
                 data-ad-slot="adx-23335185836-banner2"
                 data-tag-src="gamtg"
                 data-test-id="2"></ins>
        </div>
        <div class="ad-info" id="info-2">ç­‰å¾…æ£€æµ‹...</div>

        <!-- Ad Unit 3 -->
        <h3>Banner 3 (adx-23335185836-banner3)</h3>
        <div class="ad-container" id="ad-wrapper-3">
            <ins class="adsbygoogle"
                 style="display:inline-block;width:336px;height:280px"
                 data-ad-client="ca-pub-5058896253332104"
                 data-ad-slot="adx-23335185836-banner3"
                 data-tag-src="gamtg"
                 data-test-id="3"></ins>
        </div>
        <div class="ad-info" id="info-3">ç­‰å¾…æ£€æµ‹...</div>
    </div>

    <div class="test-section">
        <h2>å®æ—¶æ—¥å¿—</h2>
        <div class="log-area" id="log-area">ç­‰å¾…å¹¿å‘ŠåŠ è½½...</div>
    </div>

    <!-- AdX Direct Script -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle_direct.js?client=ca-pub-5058896253332104"
            crossorigin="anonymous"></script>

    <script>
        // æ—¥å¿—åŠŸèƒ½
        const logArea = document.getElementById('log-area');
        let logBuffer = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString('zh-CN', { hour12: false });
            const prefix = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : type === 'warning' ? 'âš ï¸' : 'â„¹ï¸';
            const logMessage = `[${timestamp}] ${prefix} ${message}`;
            logBuffer.push(logMessage);
            logArea.textContent = logBuffer.join('\n');
            logArea.scrollTop = logArea.scrollHeight;
            console.log(logMessage);
        }

        function clearLogs() {
            logBuffer = [];
            logArea.textContent = 'æ—¥å¿—å·²æ¸…é™¤';
        }

        // è®¾ç½®æµ‹è¯•æ—¶é—´
        document.getElementById('test-time').textContent = new Date().toLocaleString('zh-CN');

        // æ£€æµ‹å¹¿å‘ŠåŠ è½½çŠ¶æ€
        function checkAdStatus(adElement) {
            const testId = adElement.dataset.testId;
            
            // å¦‚æœæ²¡æœ‰testIdï¼Œè·³è¿‡ï¼ˆå¯èƒ½æ˜¯è„šæœ¬è‡ªåŠ¨ç”Ÿæˆçš„é¢å¤–å…ƒç´ ï¼‰
            if (!testId) {
                return { isSuccess: false, status: { testId: 'unknown', slot: 'unknown' }, reason: 'è·³è¿‡ï¼šæ— testId' };
            }
            
            const infoDiv = document.getElementById(`info-${testId}`);
            
            const status = {
                testId: testId,
                slot: adElement.dataset.adSlot,
                adsbyGoogleStatus: adElement.dataset.adsbyGoogleStatus || 'undefined',
                clientRendered: adElement.dataset.adsbygoogleStatus || 'undefined',
                hasIframe: false,
                iframeHeight: 0,
                containerHeight: adElement.offsetHeight,
                hasGoogleQueryId: false,
                hasGoogleAdsIframe: false,
                innerHTML: adElement.innerHTML.length
            };

            // æ£€æŸ¥ iframe
            const iframe = adElement.querySelector('iframe');
            if (iframe) {
                status.hasIframe = true;
                status.iframeHeight = iframe.offsetHeight || iframe.getBoundingClientRect().height;
                status.iframeSrc = iframe.src.substring(0, 50) + '...';
            }

            // æ£€æŸ¥ Google æŸ¥è¯¢ID
            const googleQueryElement = adElement.querySelector('[data-google-query-id]');
            if (googleQueryElement) {
                status.hasGoogleQueryId = true;
                status.googleQueryId = googleQueryElement.dataset.googleQueryId;
            }

            // æ£€æŸ¥ Google Ads iframe
            const googleAdsIframe = adElement.querySelector('iframe[id^="google_ads_iframe"]');
            if (googleAdsIframe) {
                status.hasGoogleAdsIframe = true;
            }

            // åˆ¤æ–­åŠ è½½çŠ¶æ€
            let isSuccess = false;
            let reason = '';

            if (status.adsbyGoogleStatus === 'done' || status.clientRendered === 'done') {
                if (status.iframeHeight > 50) {
                    isSuccess = true;
                    reason = 'âœ… çŠ¶æ€ä¸º done ä¸” iframe é«˜åº¦ > 50px';
                } else {
                    reason = 'âš ï¸ çŠ¶æ€ä¸º done ä½† iframe é«˜åº¦ä¸è¶³';
                }
            } else if (status.hasIframe && status.iframeHeight > 50) {
                isSuccess = true;
                reason = 'âœ… æœ‰æœ‰æ•ˆ iframe (é«˜åº¦ > 50px)';
            } else if (status.hasIframe) {
                reason = `âš ï¸ æœ‰ iframe ä½†é«˜åº¦ä¸è¶³ (${status.iframeHeight}px)`;
            } else if (status.hasGoogleQueryId || status.hasGoogleAdsIframe) {
                reason = 'âš ï¸ æœ‰ Google å®¹å™¨ä½†æ— æœ‰æ•ˆ iframe';
            } else if (status.innerHTML > 0) {
                reason = `âš ï¸ å®¹å™¨æœ‰å†…å®¹ (${status.innerHTML} å­—ç¬¦) ä½†æ— å¹¿å‘Šå…ƒç´ `;
            } else {
                reason = 'âŒ å®¹å™¨ä¸ºç©ºï¼Œå¹¿å‘Šæœªè¯·æ±‚æˆ–è¯·æ±‚å¤±è´¥';
            }

            // æ›´æ–°ä¿¡æ¯æ˜¾ç¤º
            if (!infoDiv) {
                console.warn(`æ‰¾ä¸åˆ°info-${testId}å…ƒç´ ï¼Œè·³è¿‡æ˜¾ç¤º`);
                return { isSuccess, status, reason };
            }
            
            const statusClass = isSuccess ? 'status-success' : (status.innerHTML > 0 ? 'status-pending' : 'status-failed');
            infoDiv.className = `ad-info ${statusClass}`;
            infoDiv.innerHTML = `
                <div><strong>çŠ¶æ€åˆ¤å®š:</strong> ${reason}</div>
                <div><strong>data-adsbygoogle-status:</strong> ${status.clientRendered}</div>
                <div><strong>data-adsby-google-status:</strong> ${status.adsbyGoogleStatus}</div>
                <div><strong>å®¹å™¨é«˜åº¦:</strong> ${status.containerHeight}px</div>
                <div><strong>æœ‰ iframe:</strong> ${status.hasIframe ? 'æ˜¯' : 'å¦'}</div>
                ${status.hasIframe ? `<div><strong>iframe é«˜åº¦:</strong> ${status.iframeHeight}px</div>` : ''}
                ${status.iframeSrc ? `<div><strong>iframe src:</strong> ${status.iframeSrc}</div>` : ''}
                <div><strong>æœ‰ Google æŸ¥è¯¢ID:</strong> ${status.hasGoogleQueryId ? 'æ˜¯ (' + (status.googleQueryId || 'N/A') + ')' : 'å¦'}</div>
                <div><strong>æœ‰ Google Ads iframe:</strong> ${status.hasGoogleAdsIframe ? 'æ˜¯' : 'å¦'}</div>
                <div><strong>innerHTML é•¿åº¦:</strong> ${status.innerHTML} å­—ç¬¦</div>
            `;

            return { isSuccess, status, reason };
        }

        function checkAllAds() {
            log('å¼€å§‹æ£€æŸ¥æ‰€æœ‰å¹¿å‘ŠçŠ¶æ€...', 'info');
            const ads = document.querySelectorAll('.adsbygoogle');
            let successCount = 0;
            let failedCount = 0;

            ads.forEach(ad => {
                const result = checkAdStatus(ad);
                
                // è·³è¿‡æ²¡æœ‰testIdçš„å¹¿å‘Šï¼ˆå¯èƒ½æ˜¯è„šæœ¬æ’å…¥çš„é¢å¤–å…ƒç´ ï¼‰
                if (result.status.testId === 'unknown') {
                    return;
                }
                
                if (result.isSuccess) {
                    successCount++;
                    log(`å¹¿å‘Š ${result.status.testId} [${result.status.slot}]: ${result.reason}`, 'success');
                } else {
                    failedCount++;
                    log(`å¹¿å‘Š ${result.status.testId} [${result.status.slot}]: ${result.reason}`, result.status.innerHTML > 0 ? 'warning' : 'error');
                }
            });

            log(`æ£€æŸ¥å®Œæˆ: ${successCount} ä¸ªæˆåŠŸ, ${failedCount} ä¸ªå¤±è´¥/å¾…åŠ è½½`, 'info');
        }

        // å¹¿å‘ŠåŠ è½½ç›‘æ§
        log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹ç›‘æ§å¹¿å‘Š...', 'info');

        // å°è¯•æ¨é€å¹¿å‘Š
        window.addEventListener('load', () => {
            log('window.load äº‹ä»¶è§¦å‘', 'info');
            
            // æ£€æŸ¥ adsbygoogle æ˜¯å¦å·²åŠ è½½
            if (typeof (adsbygoogle) !== 'undefined') {
                log('âœ… adsbygoogle å¯¹è±¡å·²å­˜åœ¨', 'success');
                
                const ads = document.querySelectorAll('.adsbygoogle');
                log(`æ‰¾åˆ° ${ads.length} ä¸ªå¹¿å‘Šå•å…ƒ`, 'info');
                
                ads.forEach((ad, index) => {
                    try {
                        log(`å°è¯•æ¨é€å¹¿å‘Š ${index + 1} [${ad.dataset.adSlot}]...`, 'info');
                        (adsbygoogle = window.adsbygoogle || []).push({});
                        log(`âœ… å¹¿å‘Š ${index + 1} æ¨é€æˆåŠŸ`, 'success');
                    } catch (e) {
                        log(`âŒ å¹¿å‘Š ${index + 1} æ¨é€å¤±è´¥: ${e.message}`, 'error');
                    }
                });
                
                // 3ç§’åé¦–æ¬¡æ£€æŸ¥
                setTimeout(() => {
                    log('--- 3ç§’åé¦–æ¬¡æ£€æŸ¥ ---', 'info');
                    checkAllAds();
                }, 3000);
                
                // 10ç§’åç¬¬äºŒæ¬¡æ£€æŸ¥
                setTimeout(() => {
                    log('--- 10ç§’åç¬¬äºŒæ¬¡æ£€æŸ¥ ---', 'info');
                    checkAllAds();
                }, 10000);
                
            } else {
                log('âŒ adsbygoogle å¯¹è±¡æœªæ‰¾åˆ°ï¼Œè„šæœ¬å¯èƒ½æœªåŠ è½½', 'error');
            }
        });

        // ç›‘å¬ adsbygoogle è„šæœ¬åŠ è½½
        let checkScriptInterval = setInterval(() => {
            if (typeof (adsbygoogle) !== 'undefined') {
                clearInterval(checkScriptInterval);
                log('âœ… adsbygoogle è„šæœ¬å·²åŠ è½½', 'success');
            }
        }, 100);

        // 10ç§’ååœæ­¢æ£€æŸ¥
        setTimeout(() => {
            clearInterval(checkScriptInterval);
        }, 10000);
    </script>
</body>
</html>
