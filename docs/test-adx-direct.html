<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPT å¹¿å‘Šæµ‹è¯• - Google Publisher Tag</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .ad-container {
            margin: 20px 0;
            padding: 10px;
            border: 2px dashed #ccc;
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .ad-info {
            margin: 10px 0;
            padding: 10px;
            background: #f9f9f9;
            border-left: 4px solid #4CAF50;
            font-family: monospace;
            font-size: 12px;
        }
        .log-area {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
        .status-success { color: #4CAF50; }
        .status-failed { color: #f44336; }
        .status-pending { color: #FF9800; }
    </style>
</head>
<body>
    <h1>ğŸ§ª GPT å¹¿å‘ŠåŠ è½½æµ‹è¯• (Google Publisher Tag)</h1>
    
    <div class="test-section">
        <h2>æµ‹è¯•ä¿¡æ¯</h2>
        <div class="ad-info">
            <div><strong>ç½‘ç»œä»£ç :</strong> 23335185836</div>
            <div><strong>å¹¿å‘Šè„šæœ¬:</strong> gpt.js (Google Publisher Tag)</div>
            <div><strong>æµ‹è¯•æ—¶é—´:</strong> <span id="test-time"></span></div>
        </div>
        <button onclick="checkAllAds()">ğŸ” æ£€æŸ¥æ‰€æœ‰å¹¿å‘ŠçŠ¶æ€</button>
        <button onclick="clearLogs()">ğŸ—‘ï¸ æ¸…é™¤æ—¥å¿—</button>
        <button onclick="location.reload()">ğŸ”„ åˆ·æ–°é¡µé¢</button>
    </div>

    <div class="test-section">
        <h2>GPT å¹¿å‘Šå•å…ƒæµ‹è¯•</h2>
        
        <!-- GPT Ad Unit 1 -->
        <h3>Banner 1 (div-gpt-ad-1770286007007-0)</h3>
        <div class="ad-container" id="ad-wrapper-1">
            <div id='div-gpt-ad-1770286007007-0' 
                 style='min-width: 336px; min-height: 280px;'
                 data-test-id="1"
                 data-slot-path="/23335185836/ca-pub-5058896253332104-tag/adx-23335185836-banner1">
            </div>
        </div>
        <div class="ad-info" id="info-1">ç­‰å¾…æ£€æµ‹...</div>

        <!-- GPT Ad Unit 2 -->
        <h3>Banner 2 (div-gpt-ad-1770286092616-0)</h3>
        <div class="ad-container" id="ad-wrapper-2">
            <div id='div-gpt-ad-1770286092616-0' 
                 style='min-width: 336px; min-height: 280px;'
                 data-test-id="2"
                 data-slot-path="/23335185836/ca-pub-5058896253332104-tag/adx-23335185836-banner2">
            </div>
        </div>
        <div class="ad-info" id="info-2">ç­‰å¾…æ£€æµ‹...</div>

        <!-- GPT Ad Unit 3 -->
        <h3>Banner 3 (div-gpt-ad-1770286115260-0)</h3>
        <div class="ad-container" id="ad-wrapper-3">
            <div id='div-gpt-ad-1770286115260-0' 
                 style='min-width: 336px; min-height: 280px;'
                 data-test-id="3"
                 data-slot-path="/23335185836/ca-pub-5058896253332104-tag/adx-23335185836-banner3">
            </div>
        </div>
        <div class="ad-info" id="info-3">ç­‰å¾…æ£€æµ‹...</div>

        <!-- GPT Ad Unit 4 -->
        <h3>Banner 4 (div-gpt-ad-1770286143370-0)</h3>
        <div class="ad-container" id="ad-wrapper-4">
            <div id='div-gpt-ad-1770286143370-0' 
                 style='min-width: 336px; min-height: 280px;'
                 data-test-id="4"
                 data-slot-path="/23335185836/ca-pub-5058896253332104-tag/adx-23335185836-banner4">
            </div>
        </div>
        <Google Publisher Tag (GPT) Script -->
    <script async src="https://securepubads.g.doubleclick.net/tag/js/gpt.js" crossorigin="anonymous"></script>
    <script>
      window.googletag = window.googletag || {cmd: []};
      
      // å®šä¹‰å¹¿å‘Šä½
      googletag.cmd.push(function() {
        googletag.defineSlot('/23335185836/ca-pub-5058896253332104-tag/adx-23335185836-banner1', [336, 280], 'div-gpt-ad-1770286007007-0').addService(googletag.pubads());
        googletag.defineSlot('/23335185836/ca-pub-5058896253332104-tag/adx-23335185836-banner2', [336, 280], 'div-gpt-ad-1770286092616-0').addService(googletag.pubads());
        googletag.defineSlot('/23335185836/ca-pub-5058896253332104-tag/adx-23335185836-banner3', [336, 280], 'div-gpt-ad-1770286115260-0').addService(googletag.pubads());
        googletag.defineSlot('/23335185836/ca-pub-5058896253332104-tag/adx-23335185836-banner4', [336, 280], 'div-gpt-ad-1770286143370-0').addService(googletag.pubads());
        
        googletag.pubads().enableSingleRequest();
        googletag.enableServices();
        
        console.log('âœ… GPT å¹¿å‘Šä½å·²å®šä¹‰');
      });
    
    <div class="test-section">
        <h2>å®æ—¶æ—¥å¿—</h2>
        <div class="log-area" id="log-area">ç­‰å¾…å¹¿å‘ŠåŠ è½½...</div>
    </div>

    <!-- AdX Direct Script -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle_direct.js?client=ca-pub-5058896253332104"
            crossorigin="anonymous"></script>

    <script>
        // æ—¥å¿—åŠŸèƒ½
        const logArea = document.getElementById('log-area');
        let loGPT äº‹ä»¶
        window.googletag = window.googletag || {cmd: []};
        googletag.cmd.push(function() {
            // ç›‘å¬å¹¿å‘Šå¡«å……äº‹ä»¶
            googletag.pubads().addEventListener('slotRenderEnded', function(event) {
                const slotId = event.slot.getSlotElementId();
                const isEmpty = event.isEmpty;
                const size = event.size;
                
                if (isEmpty) {
                    log(`âŒ å¹¿å‘Šä½ ${slotId} æœªå¡«å…… (No Ad)`, 'error');
                } else {
                    log(`âœ… å¹¿å‘Šä½ ${slotId} å·²å¡«å…… - å°ºå¯¸: ${size ? size.join('x') : 'unknown'}`, 'success');
                }
                
                // æ›´æ–°çŠ¶æ€
                const adElement = document.getElementById(slotId);
                if (adElement) {
                    adElement.dataset.gptStatus = isEmpty ? 'unfilled' : 'filled';
                    adElement.dataset.gptSize = size ? size.join('x') : 'unknown';
                }
            });
            
            // ç›‘å¬å¹¿å‘Šè¯·æ±‚äº‹ä»¶
            googletag.pubads().addEventListener('slotRequested', function(event) {
                const slotId = event.slot.getSlotElementId();
                divId: adElement.id,
                slotPath: adElement.dataset.slotPath,
                gptStatus: adElement.dataset.gptStatus || 'undefined',
                gptSize: adElement.dataset.gptSize || 'undefined',
                hasIframe: false,
                iframeHeight: 0,
                containerHeight: adElement.offsetHeight,
                hasGoogleAdsIframe: false,
                innerHTML: adElement.innerHTML.length
            };

            // æ£€æŸ¥ iframe (GPT ä½¿ç”¨ google_ads_iframe)
            const iframe = adElement.querySelector('iframe[id^="google_ads_iframe"]');
            if (iframe) {
                status.hasIframe = true;
                status.hasGoogleAdsIframe = true;
                status.iframeHeight = iframe.offsetHeight || iframe.getBoundingClientRect().height;
                status.iframeSrc = iframe.src;
                status.iframeSrcShort = iframe.src.substring(0, 100) + '...';
                status.iframeId = iframe.id;
                
                // æ£€æŸ¥ iframe æ˜¯å¦æœ‰å¹¿å‘Šå†…å®¹çš„URL
                status.hasAdUrl = iframe.src.includes('googleads.g.doubleclick.net') || 
                                 iframe.src.includes('tpc.googlesyndication.com') ||
                                 iframe.src.includes('securepubads.g.doubleclick.net');
            }

            // åˆ¤æ–­åŠ è½½çŠ¶æ€
            let isSuccess = false;
            let reason = '';

            // ä½¿ç”¨ GPT çŠ¶æ€
            const gptStatus = adElement.dataset.gptStatus;
            
            if (gptStatus === 'filled') {
                isSuccess = true;
                reason = `âœ… GPT Status = filled (å¹¿å‘Šå¡«å……æˆåŠŸ - ${status.gptSize})`;
            } else if (gptStatus === 'unfilled') {
                isSuccess = false;
                reason = 'âŒ GPT Status = unfilled (æ— å¹¿å‘Šå¡«å……)';
            } else {
                // çŠ¶æ€å°šæœªè®¾ç½®
                reason = `âš ï¸ GPT Status = ${gptStatus || 'undefined'} (ç­‰å¾… slotRenderEnded äº‹ä»¶
                status.hasAdUrl = iframe.src.includes('googleads.g.doubleclick.net') || 
                                 iframe.src.includes('tpc.googlesyndication.com');
                
                // å°è¯•æ£€æŸ¥ iframe å†…å®¹
                try {
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow?.document;
                    if (iframeDoc && iframeDoc.body) {
                        status.iframeBodyChildren = iframeDoc.body.children.length;
                        status.iframeBodyHTML = iframeDoc.body.innerHTML.length;
                    } else {
                        status.iframeBodyChildren = 'cross-origin';
                        status.iframeBodyHTML = 'cross-origin';
                    }
                } catch (e) {
                    status.iframeBodyChildren = 'blocked';
                    status.iframeBodyHTML = 'blocked';
                }
            }

            // æ£€æŸ¥ Google æŸ¥è¯¢ID
            const googleQueryElement = adElement.querySelector('[data-google-query-id]');
            if (googleQueryElement) {
                status.hasGoogleQueryId = true;
                status.googleQueryId = googleQueryElement.dataset.googleQueryId;
            }

            // æ£€æŸ¥ Google Ads iframe
            const googleAdsIframe = adElement.querySelector('iframe[id^="google_ads_iframe"]');
            if (googleAdsIframe) {
                status.hasGoogleAdsIframe = true;
            }

            // åˆ¤æ–­åŠ è½½çŠ¶æ€
            let isSuccess = false;gptStatus === 'unfilled' ? 'status-failed' : 'status-pending');
            infoDiv.className = `ad-info ${statusClass}`;
            infoDiv.innerHTML = `
                <div><strong>çŠ¶æ€åˆ¤å®š:</strong> ${reason}</div>
                <div><strong>Div ID:</strong> ${status.divId}</div>
                <div><strong>Slot Path:</strong> <span style="font-size:10px;">${status.slotPath}</span></div>
                <div><strong>ğŸ”‘ GPT Status:</strong> <span style="color:#f00;font-weight:bold;">${gptStatus || 'undefined'}</span></div>
                <div><strong>å¹¿å‘Šå°ºå¯¸:</strong> ${status.gptSize}</div>
                <div><strong>å®¹å™¨é«˜åº¦:</strong> ${status.containerHeight}px</div>
                <div><strong>æœ‰ GPT iframe:</strong> ${status.hasGoogleAdsIframe ? 'æ˜¯' : 'å¦'}</div>
                ${status.hasIframe ? `<div><strong>iframe ID:</strong> ${status.iframeId}</div>` : ''}
                ${status.hasIframe ? `<div><strong>iframe é«˜åº¦:</strong> ${status.iframeHeight}px</div>` : ''}
                ${status.hasIframe ? `<div><strong>æœ‰å¹¿å‘Š URL:</strong> ${status.hasAdUrl ? 'æ˜¯' : 'å¦'}</div>` : ''}
                ${status.iframeSrcShort ? `<div><strong>iframe src:</strong> <span style="font-size:9px;word-break:break-all;">${status.iframeSrcShort}</span></div>` : ''}
            }

            // æ›´æ–°ä¿¡æ¯æ˜¾ç¤º
            if (!infoDiv) {
                console.warn(`æ‰¾ä¸åˆ°info-${testId}å…ƒç´ ï¼Œè·³è¿‡æ˜¾ç¤º`);
                return { isSuccess, status, reason };
            }
            
            const statusClass = isSuccess ? 'status-success' : (adStatus === 'unfilled' ? 'status-failed' : 'status-pending');
            infoDiv.className = `ad-info ${statusClass}`;
            infoDiv.innerHTML = `
                <div><strong>çŠ¶æ€åˆ¤å®š:</strong> ${reason}</div>
                <div><strong>ğŸ”‘ data-ad-status:</strong> <span style="color:#f00;font-weight:bold;">${adStatus || 'undefined'}</span></div>
                <div><strong>data-adsbygoogle-status:</strong> ${status.adsbygoogleStatus}</div>
                <div><strong>å®¹å™¨é«˜åº¦:</strong> ${status.containerHeight}px</div>
                <div><strong>æœ‰ iframe:</strong> ${status.hasIframe ? 'æ˜¯' : 'å¦'}</div>
                ${statu GPT å¹¿å‘ŠçŠ¶æ€...', 'info');
            const ads = document.querySelectorAll('[id^="div-gpt-ad-"]');
            let successCount = 0;
            let failedCount = 0;

            ads.forEach(ad => {
                const result = checkAdStatus(ad);
                
                // è·³è¿‡æ²¡æœ‰testIdçš„å¹¿å‘Š
                if (result.status.testId === 'unknown') {
                    return;
                }
                
                if (result.isSuccess) {
                    successCount++;
                    log(`å¹¿å‘Š ${result.status.testId} [${result.status.divId}]: ${result.reason}`, 'success');
                    if (result.status.hasIframe) {
                        log(`  â””â”€ iframe: ${result.status.iframeId}, é«˜åº¦: ${result.status.iframeHeight}px`, 'info');
                        log(`  â””â”€ src: ${result.status.iframeSrc ? result.status.iframeSrc.substring(0, 120) : 'N/A'}`, 'info');
                    }
                } else {
                    failedCount++;
                    log(`å¹¿å‘Š ${result.status.testId} [${result.status.divId}]: ${result.reason}`, result.status.innerHTML > 0 ? 'warning' : 'error');
                    if (result.status.hasIframe) {
                        log(`  â””â”€ iframeé«˜åº¦: ${result.status.iframeHeight}px
                if (result.status.testId === 'unknown') {
                    return;
                }
                
                if (result.isSuccess) {
           GPT å¹¿å‘ŠåŠ è½½ç›‘æ§
        log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹ç›‘æ§ GPT å¹¿å‘Š...', 'info');

        // æ˜¾ç¤º GPT å¹¿å‘Š
        window.addEventListener('load', () => {
            log('window.load äº‹ä»¶è§¦å‘', 'info');
            
            // æ£€æŸ¥ googletag æ˜¯å¦å·²åŠ è½½
            if (typeof googletag !== 'undefined' && googletag.apiReady) {
                log('âœ… googletag API å·²å°±ç»ª', 'success');
                
                googletag.cmd.push(function() {
                    // æ˜¾ç¤ºæ‰€æœ‰å¹¿å‘Š
                    log('å¼€å§‹æ˜¾ç¤º GPT å¹¿å‘Š...', 'info');
                    googletag.display('div-gpt-ad-1770286007007-0');
                    log('âœ… å¹¿å‘Š 1 display è°ƒç”¨å®Œæˆ', 'success');
                    
                    googletag.display('div-gpt-ad-1770286092616-0');
                    log('âœ… å¹¿å‘Š 2 display è°ƒç”¨å®Œæˆ', 'success');
                    
                    googletag.display('div-gpt-ad-1770286115260-0');
                    log('âœ… å¹¿å‘Š 3 display è°ƒç”¨å®Œæˆ', 'success');
                    
                    googletag.display('div-gpt-ad-1770286143370-0');
                    log('âœ… å¹¿å‘Š 4 display è°ƒç”¨å®Œæˆ', 'success');
                });
                
                // 3ç§’åé¦–æ¬¡æ£€æŸ¥
                setTimeout(() => {
                    log('--- 3ç§’åé¦–æ¬¡æ£€æŸ¥ ---', 'info');
                    checkAllAds();
                }, 3000);
                
                // 10ç§’åç¬¬äºŒæ¬¡æ£€æŸ¥
                setTimeout(() => {
                    log('--- 10ç§’åç¬¬äºŒæ¬¡æ£€æŸ¥ ---', 'info');
                    checkAllAds();
                }, 10000);
                
            } else {
                log('âŒ googletag API æœªå°±ç»ª', 'error');
                
                // ç­‰å¾…ä¸€ä¸‹å†è¯•
                setTimeout(() => {
                    if (typeof googletag !== 'undefined' && googletag.apiReady) {
                        log('âœ… googletag API å»¶è¿Ÿå°±ç»ª', 'success');
                        location.reload();
                    } else {
                        log('âŒ googletag API åŠ è½½å¤±è´¥', 'error');
                    }
                }, 2000);
            }
        });

        // ç›‘å¬ googletag è„šæœ¬åŠ è½½
        let checkScriptInterval = setInterval(() => {
            if (typeof googletag !== 'undefined' && googletag.apiReady) {
                clearInterval(checkScriptInterval);
                log('âœ… GPT è„šæœ¬å·²åŠ è½½å¹¶å°±ç»ª', 'success');
            }
        }, 100);

        // 10ç§’ååœæ­¢æ£€æŸ¥
        setTimeout(() => {
            clearInterval(checkScriptInterval);
            if (typeof googletag === 'undefined' || !googletag.apiReady) {
                log('âŒ GPT è„šæœ¬åŠ è½½è¶…æ—¶', 'error');
            }
            } else {
                log('âŒ adsbygoogle å¯¹è±¡æœªæ‰¾åˆ°ï¼Œè„šæœ¬å¯èƒ½æœªåŠ è½½', 'error');
            }
        });

        // ç›‘å¬ adsbygoogle è„šæœ¬åŠ è½½
        let checkScriptInterval = setInterval(() => {
            if (typeof (adsbygoogle) !== 'undefined') {
                clearInterval(checkScriptInterval);
                log('âœ… adsbygoogle è„šæœ¬å·²åŠ è½½', 'success');
            }
        }, 100);

        // 10ç§’ååœæ­¢æ£€æŸ¥
        setTimeout(() => {
            clearInterval(checkScriptInterval);
        }, 10000);
    </script>
</body>
</html>
